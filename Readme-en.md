<h1 align="center">
  <a href="https://github.com/Tang1705/Reconstruction" title="3D Reconstruction of high-speed rail-wheel based on coded structured light">
    <img alt="Reconstruction" src="http://static.zybuluo.com/TangWill/jhiwlfucn275608lfkr5yw86/icon.png" width="200px" height="200px" />
  </a>
  <br />
  åŸºäºç¼–ç ç»“æ„å…‰çš„é«˜é“è½®è½¨å§¿æ€ä¸‰ç»´é‡å»º
</h1>
<p align="center">
  3D Reconstruction of high-speed rail-wheel based on coded structured light
</p>
<div align="center">
  <a href="http://gjcxcy.bjtu.edu.cn/NewLXItemListForStudentDetail.aspx?ItemNo=594113&year=2020&type=student&IsLXItem=1">
    <img alt="Organization" src="https://img.shields.io/badge/Organization-BJTU-072063.svg?style=shield&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAaCAYAAABCfffNAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAQ4SURBVEhLfZZ3qI5RGMC/j+vae3Otskn2JmSma0SZJUkR4h+biBuyytZNyChKlJ0tIbtsMq+V7L1dv9/nfa/vWk/9Ot973nOe5zzrvF808h9JT0/PztAIWkBR+ArZ4BtkhadwEE5Eo9EvjH+VfxrBQG+G5nAGDkBFOIqyj4y+L8LgATTeFLbDNt6nM/5f2FwSZkMPyAdRyAqDIEewJgF6Qr3gOQcMhHmQ37l4yRKMMWFBJYbRsA5ywoe4k92F8j9/RpzLBW980DtYxU/3aUgvMyTDCC9KMwyBuXABSkIt5l3TGsxFF543MI6HNCjqe9Cz9jznAQ85h+fcjDHJyAmT0xg2caLzwbNG3sEY0EOV3oeXYEjKgp5dguVQHc6w/yV76/K7O78nM/70hMk2DB/AkyU5h3iANWCFTYKJcAzygcbnwzgoBItBY6/Yr87HoLHGjJFYUhmXgp44qZIdsAJ2g7HuAu1AhaXAAngPHs78DIVW0BdqQQfQaFsYqlVdOwePwHI8DWPhOmjoO6jA8DwDRS9rQzIh+cS4BB7ASCgIR2AfqKOiRuyFgyxW2RbwtMVgIXOfAyW+awIWh3IHzN1wI8EaG3Em1IcbcIg5c2fvdNSICt1kKRrLBHjB7zQUtIWWPNvpO8EwGV4rx1Cam+6sSWb0MG+hLHs9lHIbYp4kMOkCC8BnO/2sz8gUSAGbrjA0A2Ou9/3BMBta93SEk5CMnljVolcPoyr9/WrxFMZXGQbHwRPaYIkBVpz7vLd6wjKwrC1z5+N1ftFITAIvfPkaDIknMe56Y3Ma0lMBJ8CyPsAabwILwjDbsOYiXmKeJGLAhM6AMqCLlSGU4qCiBXAVroDGvQzD2JtX+6wCuD8JnfXDsGnkc/DChdVgL7QMFyANwJD1Asu2DthPPSAUbwLFdrAF7H5zZ8990shNyAu3wEaztnW5DobsfivH/hGrJaQ57y135SHYnOoz+R5Ew+UgzcnDYPKMs+EysbvAO8tkXwa/JTWhahyWthWn2IBW2FowIq5X7Pw98deKpTgK9MKrxITr4QTwQ2UI9MbfHu4iPAnmvAj1ZBZYkaZgNbh3RBaS56dUpQNgM3jj6q5GrKhU8N5S/MaIV7pJN5TewJb8VLBXbNj90A9Woj8juZawSg2TFbKLl68DL01wZ1CpXtj9htSSdW4PuK8b1Ah+e2k2RMc8xl9Ng0JP55U9lpePefbLZ4dbtnpriIy1YbOETaw3hUa7gt/5reD6wZCCnheMmTpTQybQL+Mi8F4yvrpvxajsHpgzPSqGksOBt67zD4eHsQCm8y68sTMbUQKP/IQ+h/VgjvRIcb3euMbSnw6GrAD0Ab1PxUCmrv/DiIIh5/0g2YBWkXG3F/TKq0MvzUkJ8MNUBTai/BDjH/JXI6EExrwFOoHfcxWH/168JWxgD3ANA+EV85tEIj8AtaCkdv/9vSUAAAAASUVORK5CYII=" />
  </a>
  <a href="https://tang5618.com/wordpress/?p=598">
    <img alt="Webpage" src="https://img.shields.io/badge/Link-Webpage-c00000.svg?style=shield&logo=wordpress" />
  </a>
 <!--<a href="https://github.com/Tang1705/Reconstruction">
    <img alt="Github" src="https://img.shields.io/badge/Github-%20%20%20%20%20%20Repository-%2324292e.svg?style=shield&logo=Github" />
  </a>-->
  <a href="http://tang5618.com/data/pdf/wordpress/tq.pdf">
    <img alt="Poster" src="https://img.shields.io/badge/Poster-PDF-B50052.svg?style=shield&logo=adobe-indesign&logoColor=ffffff" />
  </a>
    <a href="https://github.com/Tang1705/Reconstruction/raw/master/Exe/Reconstructionn.exe">
    <img alt="Software" src="https://img.shields.io/badge/Release-EXE-2f528f.svg?style=shield&logo=windows" />
  </a>
  <a href="https://github.com/Tang1705/Reconstruction/raw/master/Doc/%E7%BB%93%E6%9E%84%E5%85%89%E4%B8%89%E7%BB%B4%E9%87%8D%E5%BB%BA%E8%BD%AF%E4%BB%B6%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C.pdf">
    <img alt="User-Guide" src="https://img.shields.io/badge/User%20Manual-PDF-548235.svg?style=shield&logo=adobe-acrobat-reader" />
  </a>
  <a href="https://github.com/Tang1705/Reconstruction/raw/master/Doc/%E7%BB%93%E6%9E%84%E5%85%89%E4%B8%89%E7%BB%B4%E9%87%8D%E5%BB%BA%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90.pdf">
    <img alt="Software-Design-Patter" src="https://img.shields.io/badge/Design%20Pattern-PDF-548235.svg?style=shield&logo=latex" />
  </a>
      <br />
   <br />
    <a href="./Readme.md">
      <img src="https://img.shields.io/badge/Readme-%E4%B8%AD%E6%96%87%E7%89%88%E6%9C%AC%20%E2%86%92-gray.svg?colorA=655BE1&colorB=4F44D6&style=for-the-badge"/>
    </a>
    <a href="./Readme-en.md">
      <img src="https://img.shields.io/badge/Readme-English%20Version%20%E2%86%92-gray.svg?colorA=61c265&colorB=4CAF50&style=for-the-badge"/>
    </a>
    <br/>
    <br/>
 <!-- <p align="center">
    <a href="./Readme.md">ä¸­æ–‡ç‰ˆæœ¬</a>
    Â·
    <a href="./Readme-en.md">English Version</a>
  </p>-->
</div>

## [ğŸ‘ï¸â€ğŸ—¨ï¸](https://emojipedia.org/eye-in-speech-bubble/) Overview

The wheel-rail attitude of high-speed rail reflects the complex dynamic interaction and restraint relationship between wheels and rails. Mastering the true contact attitude between them is an important foundation for ensuring the safe of high-speed railways. How to accurately obtain the wheel-track attitude of high-speed railways has always been a hot research field in domestic railway scientific research. However, it is imprecise and unreliable to obtain the wheel-rail contact attitude from 2D image. Extracting the feature points of the wheel-rail surface and reconstructing a 3D model can obtain the wheel-rail contact attitude more realistically and accurately.


Due to the fast running speed of high-speed trains, the wheel-rail surface is relatively smooth and there are no obvious feature points, which brings great challenges to the 3D reconstruction based on feature point extraction.

<p align="center">
    <img src="./img/cn/01.gif" alt="01" width="45%" height="45%"   hspace="10" /> <img src="./img/cn/02.gif" alt="02" width="45%" height="45%"  />
    <br>
</p>

3D reconstruction technology is an important branch of computer vision technology and a popular research direction combining computer vision and computer image graphics. According to whether it is in contact with the measured object during measurement, it can be divided into contact measurement and non-contact measurement.

<div class="imgs" align="center" ><img src="./img/en/03.png" alt="16" width="50%" height="50%"/></div>

Although the contact measurement method has high measurement accuracy, the measurement efficiency is low, the speed is slow, and improper operation can easily damage the surface of the object to be measured, and because the probe has a certain surface area, it is difficult to measure objects with complex surfaces and does not have universality and versatility. Non-contact three-dimensional measurement methods can be divided into two categories: active measurement and passive measurement. The former is to project a designed pattern onto the surface of the target object. The pattern is distorted due to the height fluctuation of the object, and the target object is obtained by matching the distorted pattern. The latter is to illuminate the target object with ambient light and then detect the characteristic points of the target object to obtain its data. The non-contact measurement method has become the research trend of three-dimensional profile measurement due to its advantages of no damage, high measurement speed, and simplicity.
The coded structured light method used in the project uses a certain pattern of coded structured light patterns projected by the projector to encode the target object, uses the camera to obtain the object image, and uses the computer to decode the resulting image, using the image points in the camera and the projector The point correspondence in Calculates the space coordinates of the surface points of the object, obtains the three-dimensional information of the object, and restores the three-dimensional shape of the object. The structured light system is shown in the following figure.

<div class="imgs" align="center" ><img src="./img/en/04.png" alt="17" width="80%" height="80%"/></div>

The 3D reconstruction technology of coded structured light method is mainly composed of five key technologies: system calibration, structured light coding, image acquisition, structured light decoding and three-dimensional coordinate calculation.

<div class="imgs" align="center" ><img src="./img/en/05.png" alt="19" width="80%" height="80%"/></div>

- System Calibration: The system consists of a camera, a projector and a computer. The goal of calibration is to calculate the internal parameter matrix and the lens distortion coefficient of the camera and the projector and the external parameter matrix of the relative position between the two.
- Structured Light Coding: The "identity" of each point of the pattern can be identified through coding.
-  Image Capture: The projector projects the coded structured light pattern on the surface of the target, and the pattern will be distorted with the modulation of the surface shape of the object. What is captured by the camera is the structured light image modulated by the object. The modulated image reflects the three-dimensional information of the surface shape of the object.
- Structured Light Decoding: Decode the captured structured light image, the decoding method depends on the encoding method. The purpose is to establish the correspondence between the feature points of the camera plane and the projection plane.
- 3D Coordinate Calculation: Using the corresponding relationship between the feature points  and the calibration results, the 3D information of the feature points are obtained based on the principle of triangulation.

The coded structured light mainly include Time-multiplexing and Space Codification. Although Time-multiplexing has good reconstruction accuracy, it is not a good choice for moving objects because of the need to project multiple pictures on the surface of the object. Compared with Time-multiplexing, Space Codification has a lower reconstruction accuracy, but because only one picture is projected, it is often used for object reconstruction of dynamic objects.

In summary, given the difficulty in the project that the surface of the wheel and rail is smooth and the feature points are not easy to extract, the feature points on the surface of the object can be artificially increased by projecting the coding pattern on the surface of the object. The Space Codification only needs a single projection, which is suitable for the reconstruction of dynamic objects. Therefore, this project mainly studies the method of Space Codification to obtain a relatively finer and high-density three-dimensional point cloud (point cloud, a collection of feature points on the surface of the object. These points Contains information such as the three-dimensional coordinates and color of the surface of the object).

## [ğŸ“·](https://emojipedia.org/camera/) Algorithm

<table><tr><td width="500px"><div class="img" align="center"><img src="./img/cn/06.png" alt="12" height="100%" width="100%"></div></td><td>The main innovations of the project are as follows:
    <ul><li><b>Stripe center extraction with sub-pixel precision</b>: Designed and implemented the coded structured light pattern and the stripe center point extraction algorithm suitable for the pattern, and the stripe center point is accurate to the sub-pixel level</li>
        <li><b>Increase point cloud density through wavelet transform</b>: An improved method of windowed Fourier transform for fringe phase analysis is proposed. The wavelet transform based on generalized Morse wavelet is used for analysis to obtain the phase information of non-central points. Increase point cloud density</li>
        <li><b>Construction of a full-process 3D reconstruction platform</b>: The above algorithm and point cloud visualization are packaged into structured light 3D reconstruction software, which completes the 3D reconstruction of rails and multiple geometric bodies, which is expected to be used for wheel-rail posture reconstruction and visualization</li></ul></td></tr></table>

<table> <tr> <td>Pattern Creation</td><td width="600px">The pattern is designed in HSV color space. And the pattern consists on a colored sinusoidal fringe pattern
<ul>
<li> The H channel is coded in the ğµ(3,4) sequence. The stripes are the basic elements of the coding pattern. Different values correspond to the three colors of red, blue, and green.</li>
<li> The S channel is set to 1 for all pixels.</li>
<li> The V channel is calculated by the sinusodial signal.</li>
</ul>
    <p>There are 64 stripes in the coding pattern, and the stripe width is 14 ğ‘ğ‘–ğ‘¥ğ‘’ğ‘™, with the center point of the stripe as the feature point of the projection pattern</p>
â™£ The ğ·ğ‘’ ğµğ‘Ÿğ‘¢ğ‘–ğ‘—ğ‘› sequence is composed of ğ‘› different elements, and any consecutive subsequence whose length is ğ‘š only appears once
    </td><td><div align="center"><img src="./img/cn/07.png" alt="21" width="100%" height="100%"/></div></td></tr><tr><td> DeBruijn Analysis</td><td>åœ¨å¯¹ç°åº¦å›¾åƒè¿›è¡Œé¢„å¤„ç†åï¼Œä¸ºè·å¾—æ¡çº¹ä¸­å¿ƒç‚¹çš„ä½ç½®ï¼Œé‡‡ç”¨å±€éƒ¨æœ€å¤§å€¼ç®—æ³•ä»ç±»ä¼¼â€œé«˜æ–¯â€å½¢çŠ¶çš„æ¡çº¹ç°åº¦å›¾åƒä¸­æå–å›¾åƒæ¯ä¸€è¡Œçš„å±€éƒ¨æœ€å¤§å€¼ï¼ˆä»¥äºšåƒç´ ç²¾åº¦æ£€æµ‹ï¼‰ï¼Œå±€éƒ¨æœ€å¤§å€¼ç‚¹å³ä¸ºæ¡çº¹çš„ä¸­å¿ƒç‚¹ã€‚åœ¨ ğ¿ğ‘ğ‘ é¢œè‰²ç©ºé—´ä¸‹ï¼Œå¯¹æ¡çº¹ä¸­å¿ƒç‚¹çš„é¢œè‰²è¿›è¡Œåˆ†ç±»ï¼Œåœ¨ 4Ã—1 çš„çª—å£ä¸­ï¼Œå³å¯è·å¾—æ¡çº¹ä¸­å¿ƒç‚¹åœ¨æŠ•å½±å›¾æ¡ˆçš„å¯¹åº”ä½ç½®ã€‚After preprocessing the gray image, in order to extract the center point of the stripes, a local maximum algorithm is applied to searching local maxima (detected with sub-pixel precision) of each row of the image from the strips which is present a gaussian-like shape, The local maximum point is the center point of the fringe. In the ğ¿ğ‘ğ‘ color space, classify the colors of the center point of the stripe. In a 4Ã—1 window, you can get the corresponding position of the center point of the stripe in the projection pattern.</td><td><div align="center"><img src="./img/cn/08.png" alt="22" width="100%" height="100%"/></div></td></tr><tr><td>Wavelet Transform Analysis</td><td>The change of the V channel satisfies the given cosine function and contains the phase information of the non-center point of the fringe. But after the pattern is modulated by the object, the originally stable signal changes. As a non-stationary signal processing method, the wavelet transform method has been introduced into many signal processing fields, including phase extraction from fringe patterns. Comprehensive comparison of one-dimensional and two-dimensional window Fourier transform, wavelet transform and other methods, for the consideration of reconstruction accuracy and speed, the one-dimensional wavelet transform method is selected. The generalized Morse wavelet has flexible time-frequency local characteristics and strict analysis, and the effect of measuring the 3D contour of the object is better than the popular complex Morlet wavelet as the mother wavelet.</td><td><div align="center"><img src="./img/cn/09.png" alt="23" width="100%" height="100%"/></div></td></tr></table> 




## [ğŸ“½ï¸](https://emojipedia.org/film-projector/) Performance

<table> <tr align="center"> <td><div align="center"><img src="./img/cn/10.gif" alt="24" width="100%" height="100%"/></div></td><td>
   <div align="center"><img src="./img/cn/11.gif" alt="25" width="100%" height="100%"/></div> </td><td> <div align="center"><img src="./img/cn/12.gif" alt="26" width="100%" height="100%"/></div> </td></tr><tr align="center"><td>Sphere with a radius of 95mm<br>Point cloud data 17W+<br>Radius error 0.678mm<br>Calculation time 10-15s</td><td>Multi-object 3D reconstruction</td><td>3D reconstruction of rail surface</td></tr></table> 




## [ğŸ’»](https://emojipedia.org/laptop/) Demo

<a style="color:black" href="./Exe/Reconstructionn.exe">The software</a> integrates the entire process of 3D reconstruction, and implements the three functions of system calibration, 3D reconstruction and point cloud rendering. The software uses C++ as the development language and the interface development is based on the QT framework, which relies on OpenCV and PCL (Point Cloud Library) for image and point cloud data processing. It adopts some design patterns such as singleton pattern and chain of responsibility pattern, etc.  <a href="https://youtu.be/DM47pxDPks8"><img src="https://img.shields.io/badge/Demo- -%23FF0000?colorA=%23FF0000&colorB=%23FF0000&style=for-the-badge&logo=YouTube"/></a>

- UI of System Calibration 
<div class="imgs" align="center" ><img src="./img/cn/13.jpg" alt="16"  width="75%" height="75%" /></div>

- UI of 3D reconstruction
<div class="imgs" align="center" ><img src="./img/cn/14.jpg" alt="17"  width="75%" height="75%" /></div>

- UI of point cloud rendering
<div class="imgs" align="center" ><img src="./img/cn/15.jpg" alt="18"  width="75%" height="75%" /></div>

## [ğŸ”§](https://emojipedia.org/wrench/) Configuration

<table><tr align="center" style="background-color:#D9E2F3"><td width="500px">Hardware</td><td  width="500px">Version</td></tr><tr align="center"><td>Point Grey Camera</td><td>â€”â€”</td></tr><tr align="center"><td>LightCrafter4500</td><td>â€”â€”</td></tr></table>

<table><tr align="center" style="background-color:#D9E2F3"><td  width="500px">Software</td><td  width="500px">Version</td></tr><tr align="center"><td>Windows</td><td>Windows 10</td></tr><tr align="center"><td>Visual Studio</td><td>2017</td></tr><tr align="center"><td>QT</td><td>5.12.3</td></tr><tr align="center"><td>OpenCV</td><td>4.2.03</td></tr><tr align="center"><td>FlyCapture2</td><td>2.12.3.2</td></tr><tr align="center"><td>PCL</td><td>1.8.1</td></tr><tr align="center"><td>VTK</td><td>8.0</td></tr></table>

<div><text style="color:red">Note</text>: Need to configure the environment variables of the computer and the properties of the project in Visual Studio (VC++ directory-include directory, VC++-library directory and linker-input-additional dependencies)</div>

## ğŸ“œ License

The code is made available under the [Apache 2.0 License](https://www.apache.org/licenses/LICENSE-2.0).
